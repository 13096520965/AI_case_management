# è¶…æœŸé¢„è­¦é¡µé¢404é”™è¯¯ä¿®å¤

## ğŸ› é—®é¢˜æè¿°

è¶…æœŸé¢„è­¦é¡µé¢è°ƒç”¨ `/api/cases/:id` æ¥å£æ—¶è¿”å›404é”™è¯¯ã€‚

**é”™è¯¯ç¤ºä¾‹**:
- `/api/cases/1` - 404
- `/api/cases/2` - 404
- `/api/cases/3` - 404
- ...

## ğŸ” é—®é¢˜åˆ†æ

### 1. æ¥å£ç”¨é€”

`/api/cases/:id` æ¥å£ç”¨äºè·å–æ¡ˆä»¶è¯¦æƒ…ï¼Œå‰ç«¯ä»£ç åœ¨è·å–æµç¨‹èŠ‚ç‚¹åï¼Œéœ€è¦è·å–å¯¹åº”çš„æ¡ˆä»¶åç§°æ¥æ˜¾ç¤ºã€‚

**å‰ç«¯ä»£ç é€»è¾‘**:
```typescript
// è·å–è¶…æœŸèŠ‚ç‚¹å’Œå³å°†åˆ°æœŸèŠ‚ç‚¹
const allNodes = [...overdueNodes, ...upcomingNodes]

// ä¸ºæ¯ä¸ªèŠ‚ç‚¹è·å–æ¡ˆä»¶åç§°
const nodesWithCaseNames = await Promise.all(
  allNodes.map(async (node: any) => {
    try {
      const caseResponse = await request.get(`/cases/${node.case_id}`)
      return {
        ...node,
        caseName: caseResponse.data?.case_cause || `æ¡ˆä»¶ #${node.case_id}`
      }
    } catch (error) {
      // å¦‚æœæ¡ˆä»¶ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤åç§°
      return {
        ...node,
        caseName: `æ¡ˆä»¶ #${node.case_id}`
      }
    }
  })
)
```

### 2. é—®é¢˜æ ¹æº

- æµ‹è¯•æ•°æ®ä¸­çš„æµç¨‹èŠ‚ç‚¹å¼•ç”¨äº† case_id (1-10)
- ä½†æ•°æ®åº“ä¸­æ²¡æœ‰å¯¹åº”çš„æ¡ˆä»¶è®°å½•
- å¯¼è‡´æ¯æ¬¡è·å–æ¡ˆä»¶è¯¦æƒ…æ—¶éƒ½è¿”å›404

### 3. æ˜¯å¦æœ‰å¿…è¦è°ƒç”¨ï¼Ÿ

**æœ‰å¿…è¦ï¼** å› ä¸ºï¼š
1. æ˜¾ç¤ºæ¡ˆä»¶åç§°æ¯”æ˜¾ç¤º"æ¡ˆä»¶ #1"æ›´å‹å¥½
2. ç”¨æˆ·å¯ä»¥ç‚¹å‡»æ¡ˆä»¶åç§°è·³è½¬åˆ°æ¡ˆä»¶è¯¦æƒ…
3. ç¬¦åˆå®é™…ä¸šåŠ¡åœºæ™¯

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆï¼šåˆ›å»ºå¯¹åº”çš„æ¡ˆä»¶æµ‹è¯•æ•°æ®

åœ¨ç”Ÿæˆæµç¨‹èŠ‚ç‚¹æµ‹è¯•æ•°æ®æ—¶ï¼ŒåŒæ—¶åˆ›å»ºå¯¹åº”çš„æ¡ˆä»¶æ•°æ®ã€‚

## ğŸ”§ ä¿®å¤æ­¥éª¤

### 1. åˆ›å»º cases è¡¨

```sql
CREATE TABLE IF NOT EXISTS cases (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  case_number VARCHAR(100) UNIQUE,
  internal_number VARCHAR(100) UNIQUE,
  case_type VARCHAR(50),
  case_cause VARCHAR(200),
  court VARCHAR(200),
  target_amount DECIMAL(15,2),
  filing_date DATE,
  status VARCHAR(50) DEFAULT 'active',
  team_id INTEGER,
  industry_segment VARCHAR(50),
  handler VARCHAR(100),
  is_external_agent BOOLEAN DEFAULT 0,
  law_firm_name VARCHAR(200),
  agent_lawyer VARCHAR(100),
  agent_contact VARCHAR(100),
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 2. ä¿®æ”¹æµ‹è¯•æ•°æ®ç”Ÿæˆè„šæœ¬

**æ–‡ä»¶**: `backend/scripts/seed-process-nodes.js`

**æ–°å¢åŠŸèƒ½**:
- ç”Ÿæˆ10æ¡æ¡ˆä»¶æµ‹è¯•æ•°æ®
- æ¡ˆä»¶IDä¸æµç¨‹èŠ‚ç‚¹çš„case_idå¯¹åº”
- åŒ…å«æ¡ˆä»¶ç¼–å·ã€æ¡ˆç”±ã€ç±»å‹ç­‰ä¿¡æ¯

**æ¡ˆä»¶æ•°æ®**:
```javascript
const caseTemplates = [
  { id: 1, case_number: '2024-001', case_cause: 'å¼ ä¸‰è¯‰æå››åˆåŒçº çº·æ¡ˆ', case_type: 'æ°‘äº‹' },
  { id: 2, case_number: '2024-002', case_cause: 'ç‹äº”åŠ³åŠ¨äº‰è®®æ¡ˆ', case_type: 'åŠ³åŠ¨' },
  { id: 3, case_number: '2024-003', case_cause: 'èµµå…­çŸ¥è¯†äº§æƒæ¡ˆ', case_type: 'çŸ¥è¯†äº§æƒ' },
  { id: 4, case_number: '2024-004', case_cause: 'å­™ä¸ƒæˆ¿äº§çº çº·æ¡ˆ', case_type: 'æ°‘äº‹' },
  { id: 5, case_number: '2024-005', case_cause: 'å‘¨å…«äº¤é€šäº‹æ•…æ¡ˆ', case_type: 'ä¾µæƒ' },
  { id: 6, case_number: '2024-006', case_cause: 'å´ä¹å€Ÿæ¬¾çº çº·æ¡ˆ', case_type: 'æ°‘äº‹' },
  { id: 7, case_number: '2024-007', case_cause: 'éƒ‘åç¦»å©šæ¡ˆ', case_type: 'å©šå§»å®¶åº­' },
  { id: 8, case_number: '2024-008', case_cause: 'å†¯åä¸€å•†æ ‡ä¾µæƒæ¡ˆ', case_type: 'çŸ¥è¯†äº§æƒ' },
  { id: 9, case_number: '2024-009', case_cause: 'é™ˆåäºŒåŠ³åŠ¨åˆåŒæ¡ˆ', case_type: 'åŠ³åŠ¨' },
  { id: 10, case_number: '2024-010', case_cause: 'è¤šåä¸‰è‚¡æƒçº çº·æ¡ˆ', case_type: 'å…¬å¸' }
];
```

### 3. é‡æ–°ç”Ÿæˆæµ‹è¯•æ•°æ®

```bash
node legal-case-management/backend/scripts/seed-process-nodes.js
```

**é¢„æœŸè¾“å‡º**:
```
Inserting case data...
Inserted 10 case records
Cleared existing process node data
Successfully inserted 10 process node records

ç»Ÿè®¡ä¿¡æ¯:
- æ€»èŠ‚ç‚¹æ•°: 10
- è¶…æœŸèŠ‚ç‚¹: 5
- å³å°†åˆ°æœŸ: 3

âœ… Process node test data seeded successfully!
Total records: 10
```

## ğŸ“Š æ•°æ®å¯¹åº”å…³ç³»

| èŠ‚ç‚¹ID | case_id | æ¡ˆä»¶ç¼–å· | æ¡ˆä»¶åç§° | èŠ‚ç‚¹åç§° |
|--------|---------|----------|----------|----------|
| 1 | 1 | 2024-001 | å¼ ä¸‰è¯‰æå››åˆåŒçº çº·æ¡ˆ | è¯æ®æ”¶é›† |
| 2 | 2 | 2024-002 | ç‹äº”åŠ³åŠ¨äº‰è®®æ¡ˆ | æäº¤ç­”è¾©çŠ¶ |
| 3 | 3 | 2024-003 | èµµå…­çŸ¥è¯†äº§æƒæ¡ˆ | å¼€åº­å‡†å¤‡ |
| 4 | 4 | 2024-004 | å­™ä¸ƒæˆ¿äº§çº çº·æ¡ˆ | è¯æ®äº¤æ¢ |
| 5 | 5 | 2024-005 | å‘¨å…«äº¤é€šäº‹æ•…æ¡ˆ | æäº¤è¯æ® |
| 6 | 6 | 2024-006 | å´ä¹å€Ÿæ¬¾çº çº·æ¡ˆ | åº­å‰ä¼šè®® |
| 7 | 7 | 2024-007 | éƒ‘åç¦»å©šæ¡ˆ | æäº¤ä»£ç†è¯ |
| 8 | 8 | 2024-008 | å†¯åä¸€å•†æ ‡ä¾µæƒæ¡ˆ | è´¨è¯ç¯èŠ‚ |
| 9 | 9 | 2024-009 | é™ˆåäºŒåŠ³åŠ¨åˆåŒæ¡ˆ | æäº¤è¡¥å……ææ–™ |
| 10 | 10 | 2024-010 | è¤šåä¸‰è‚¡æƒçº çº·æ¡ˆ | è¯æ®æ”¶é›† |

## ğŸ§ª éªŒè¯ä¿®å¤

### 1. éªŒè¯æ¡ˆä»¶æ•°æ®

```bash
sqlite3 legal-case-management/backend/legal_case_management.db \
  "SELECT id, case_number, case_cause FROM cases;"
```

**é¢„æœŸè¾“å‡º**:
```
1|2024-001|å¼ ä¸‰è¯‰æå››åˆåŒçº çº·æ¡ˆ
2|2024-002|ç‹äº”åŠ³åŠ¨äº‰è®®æ¡ˆ
3|2024-003|èµµå…­çŸ¥è¯†äº§æƒæ¡ˆ
...
```

### 2. æµ‹è¯•API

```bash
# æµ‹è¯•æ¡ˆä»¶è¯¦æƒ…API
curl http://localhost:3000/api/cases/1 \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**é¢„æœŸå“åº”**:
```json
{
  "success": true,
  "data": {
    "id": 1,
    "case_number": "2024-001",
    "case_cause": "å¼ ä¸‰è¯‰æå››åˆåŒçº çº·æ¡ˆ",
    "case_type": "æ°‘äº‹",
    "status": "active",
    ...
  }
}
```

### 3. è®¿é—®è¶…æœŸé¢„è­¦é¡µé¢

```
URL: http://localhost:5173/notifications/alerts
```

**é¢„æœŸæ•ˆæœ**:
- âœ… ä¸å†å‡ºç°404é”™è¯¯
- âœ… æ¡ˆä»¶åç§°æ­£ç¡®æ˜¾ç¤ºï¼ˆå¦‚"å¼ ä¸‰è¯‰æå››åˆåŒçº çº·æ¡ˆ"ï¼‰
- âœ… å¯ä»¥ç‚¹å‡»æ¡ˆä»¶åç§°è·³è½¬åˆ°æ¡ˆä»¶è¯¦æƒ…

## ğŸ¯ é¡µé¢æ•ˆæœå¯¹æ¯”

### ä¿®å¤å‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¶…æœŸ | æ¡ˆä»¶ #1 | è¯æ®æ”¶é›† | å¼ ä¸‰ | è¶…æœŸ5å¤© â”‚
â”‚ è¶…æœŸ | æ¡ˆä»¶ #2 | æäº¤ç­”è¾©çŠ¶ | æå›› | è¶…æœŸ2å¤© â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¿®å¤å
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¶…æœŸ | å¼ ä¸‰è¯‰æå››åˆåŒçº çº·æ¡ˆ | è¯æ®æ”¶é›† | å¼ ä¸‰ | è¶…æœŸ5å¤© â”‚
â”‚ è¶…æœŸ | ç‹äº”åŠ³åŠ¨äº‰è®®æ¡ˆ | æäº¤ç­”è¾©çŠ¶ | æå›› | è¶…æœŸ2å¤© â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ å‰ç«¯é”™è¯¯å¤„ç†

å‰ç«¯ä»£ç å·²ç»æœ‰é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œå³ä½¿æ¡ˆä»¶ä¸å­˜åœ¨ä¹Ÿä¸ä¼šå¯¼è‡´é¡µé¢å´©æºƒï¼š

```typescript
try {
  const caseResponse = await request.get(`/cases/${node.case_id}`)
  caseName = caseResponse.data?.case_cause || `æ¡ˆä»¶ #${node.case_id}`
} catch (error) {
  // å¦‚æœè·å–å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤åç§°
  caseName = `æ¡ˆä»¶ #${node.case_id}`
}
```

ä½†è¿™ä¼šå¯¼è‡´ï¼š
1. äº§ç”Ÿå¤§é‡404é”™è¯¯æ—¥å¿—
2. å¢åŠ ä¸å¿…è¦çš„ç½‘ç»œè¯·æ±‚
3. ç”¨æˆ·ä½“éªŒä¸ä½³ï¼ˆæ˜¾ç¤º"æ¡ˆä»¶ #1"è€Œä¸æ˜¯å®é™…æ¡ˆä»¶åç§°ï¼‰

## ğŸ”„ åç»­ç»´æŠ¤

### æ·»åŠ æ–°çš„æµç¨‹èŠ‚ç‚¹

å¦‚æœè¦æ·»åŠ æ–°çš„æµç¨‹èŠ‚ç‚¹ï¼Œç¡®ä¿å¯¹åº”çš„æ¡ˆä»¶å­˜åœ¨ï¼š

```javascript
// 1. å…ˆåˆ›å»ºæ¡ˆä»¶
INSERT INTO cases (case_number, case_cause, case_type, status)
VALUES ('2024-011', 'æ–°æ¡ˆä»¶åç§°', 'æ°‘äº‹', 'active');

// 2. è·å–æ¡ˆä»¶ID
SELECT id FROM cases WHERE case_number = '2024-011';

// 3. åˆ›å»ºæµç¨‹èŠ‚ç‚¹
INSERT INTO process_nodes (case_id, node_name, handler, deadline, status)
VALUES (11, 'æ–°èŠ‚ç‚¹', 'å¼ ä¸‰', '2025-12-01', 'in_progress');
```

### é‡æ–°ç”Ÿæˆæ‰€æœ‰æµ‹è¯•æ•°æ®

```bash
node legal-case-management/backend/scripts/seed-process-nodes.js
```

## âœ… ä¿®å¤å®Œæˆ

- [x] åˆ›å»º cases è¡¨
- [x] ä¿®æ”¹æµ‹è¯•æ•°æ®ç”Ÿæˆè„šæœ¬
- [x] ç”Ÿæˆ10æ¡æ¡ˆä»¶æ•°æ®
- [x] ç”Ÿæˆ10æ¡æµç¨‹èŠ‚ç‚¹æ•°æ®
- [x] éªŒè¯æ•°æ®å¯¹åº”å…³ç³»
- [x] æµ‹è¯•APIæ­£å¸¸è¿”å›

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [è¶…æœŸé¢„è­¦APIä¿®å¤](./ALERTS-API-FIX.md)
- [æµ‹è¯•æ•°æ®ç”Ÿæˆè„šæœ¬](./backend/scripts/seed-process-nodes.js)

---

**ä¿®å¤æ—¶é—´**: 2025-11-21
**ä¿®å¤çŠ¶æ€**: âœ… å·²å®Œæˆ
**æµ‹è¯•çŠ¶æ€**: å¾…å‰ç«¯éªŒè¯
