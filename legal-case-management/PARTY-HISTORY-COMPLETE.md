# 诉讼主体历史案件功能完成

## ✅ 功能已完成

诉讼主体的历史案件对话框现在完整显示以下信息：

### 显示的列

| 序号 | 列名 | 字段名 | 宽度 | 说明 |
|------|------|--------|------|------|
| 1 | 案号 | `case_number` | 180px | 案件编号，支持悬停显示完整内容 |
| 2 | 案件类型 | `case_type` | 120px | 民事/刑事/行政等 |
| 3 | 案由 | `case_cause` | 150px+ | 案件原因，支持悬停显示完整内容 |
| 4 | 法院 | `court` | 150px+ | 受理法院，支持悬停显示完整内容 |
| 5 | **立案日期** | `filing_date` | 120px | **立案时间** ✅ |
| 6 | 状态 | `status` | 100px | 案件状态（带颜色标签）|
| 7 | 操作 | - | 100px | 查看按钮（固定在右侧）|

## 界面效果

### 历史案件对话框

```
┌──────────────────────────────────────────────────────────────────────────┐
│  某某公司 的历史案件                                                 ✕   │
├──────────────────────────────────────────────────────────────────────────┤
│ 案号                │案件类型│案由      │法院          │立案日期    │状态  │操作│
├────────────────────┼────────┼──────────┼─────────────┼───────────┼──────┼────┤
│（2024）京0105民初  │民事    │合同纠纷  │北京市朝阳区  │2024-01-15 │审理中│查看│
│12345号             │        │          │人民法院      │           │      │    │
├────────────────────┼────────┼──────────┼─────────────┼───────────┼──────┼────┤
│（2023）京0105民初  │民事    │买卖合同  │北京市朝阳区  │2023-06-20 │已结案│查看│
│67890号             │        │纠纷      │人民法院      │           │      │    │
├────────────────────┼────────┼──────────┼─────────────┼───────────┼──────┼────┤
│（2023）京0105民初  │民事    │服务合同  │北京市朝阳区  │2023-03-10 │已归档│查看│
│11111号             │        │纠纷      │人民法院      │           │      │    │
└──────────────────────────────────────────────────────────────────────────┘
```

## 数据格式

### 后端返回示例

```json
{
  "data": {
    "name": "某某公司",
    "cases": [
      {
        "id": 1,
        "case_number": "（2024）京0105民初12345号",
        "case_type": "民事",
        "case_cause": "合同纠纷",
        "court": "北京市朝阳区人民法院",
        "filing_date": "2024-01-15",
        "status": "审理中",
        "target_amount": 100000.00,
        "created_at": "2024-01-15 10:30:00"
      },
      {
        "id": 2,
        "case_number": "（2023）京0105民初67890号",
        "case_type": "民事",
        "case_cause": "买卖合同纠纷",
        "court": "北京市朝阳区人民法院",
        "filing_date": "2023-06-20",
        "status": "已结案",
        "target_amount": 50000.00,
        "created_at": "2023-06-20 14:20:00"
      }
    ],
    "total": 2
  }
}
```

### 立案日期格式

- **数据库格式**: `2024-01-15`（DATE 类型）
- **显示格式**: `2024-01-15`（YYYY-MM-DD）
- **排序**: 按创建时间倒序（最新的在前）

## 功能特性

### 1. 完整信息展示 ✅
- 案号
- 案件类型
- 案由
- 法院
- **立案日期** ✅
- 状态（带颜色标签）

### 2. 交互优化 ✅
- 长文本悬停显示完整内容
- 状态使用颜色标签区分
- 操作列固定在右侧
- 空数据友好提示

### 3. 状态标签 ✅

| 状态 | 标签颜色 | Element Plus 类型 |
|------|---------|------------------|
| 立案 | 灰色 | `info` |
| 审理中 | 蓝色 | `primary` (默认) |
| 已结案 | 绿色 | `success` |
| 已归档 | 灰色 | `info` |

## 使用流程

### 1. 打开历史案件

在诉讼主体列表中，点击某个主体的"历史案件"按钮：

```
诉讼主体列表
┌────────────────────────────────────────────────────┐
│ 主体身份 │ 实体类型 │ 名称          │ 操作          │
├──────────┼──────────┼───────────────┼───────────────┤
│ 原告     │ 企业     │ 某某公司      │ [编辑] [历史案件] [删除] │
└────────────────────────────────────────────────────┘
```

### 2. 查看历史案件

对话框显示该主体参与的所有案件：

- 显示案号、类型、案由、法院、**立案日期**、状态
- 可以点击"查看"按钮跳转到案件详情

### 3. 跳转案件详情

点击"查看"按钮后：
- 关闭历史案件对话框
- 跳转到对应案件的详情页面

## 后端查询逻辑

### SQL 查询

```sql
SELECT DISTINCT c.* 
FROM cases c
INNER JOIN litigation_parties lp ON c.id = lp.case_id
WHERE lp.name = ?
ORDER BY c.created_at DESC
```

### 查询说明

1. **关联查询**: 通过 `litigation_parties` 表关联 `cases` 表
2. **去重**: 使用 `DISTINCT` 避免重复
3. **筛选**: 根据主体名称精确匹配
4. **排序**: 按创建时间倒序，最新的案件在前

### 返回字段

返回 `cases` 表的所有字段，包括：
- `id` - 案件ID
- `case_number` - 案号
- `case_type` - 案件类型
- `case_cause` - 案由
- `court` - 法院
- `filing_date` - **立案日期** ✅
- `status` - 状态
- `target_amount` - 标的额
- `created_at` - 创建时间
- `updated_at` - 更新时间

## 测试场景

### 场景 1: 有历史案件

**前提**: 数据库中存在同名主体在多个案件中

**步骤**:
1. 点击"历史案件"按钮
2. 对话框显示案件列表

**预期结果**:
- ✅ 显示所有相关案件
- ✅ 案号、类型、案由、法院、**立案日期**、状态都正确显示
- ✅ 可以点击"查看"跳转

### 场景 2: 无历史案件

**前提**: 该主体只在当前案件中出现

**步骤**:
1. 点击"历史案件"按钮
2. 对话框显示空状态

**预期结果**:
- ✅ 显示"暂无历史案件"提示
- ✅ 界面友好

### 场景 3: 立案日期显示

**前提**: 案件有立案日期数据

**步骤**:
1. 查看历史案件列表
2. 检查立案日期列

**预期结果**:
- ✅ 立案日期正确显示（YYYY-MM-DD 格式）
- ✅ 如果没有立案日期，显示为空

## 数据示例

### 测试数据

```sql
-- 案件1
INSERT INTO cases (case_number, case_type, case_cause, court, filing_date, status)
VALUES ('（2024）京0105民初12345号', '民事', '合同纠纷', '北京市朝阳区人民法院', '2024-01-15', '审理中');

-- 案件2
INSERT INTO cases (case_number, case_type, case_cause, court, filing_date, status)
VALUES ('（2023）京0105民初67890号', '民事', '买卖合同纠纷', '北京市朝阳区人民法院', '2023-06-20', '已结案');

-- 诉讼主体（同一公司在两个案件中）
INSERT INTO litigation_parties (case_id, party_type, entity_type, name)
VALUES (1, '原告', '企业', '某某公司');

INSERT INTO litigation_parties (case_id, party_type, entity_type, name)
VALUES (2, '被告', '企业', '某某公司');
```

## 验证清单

- [x] 案号列显示正确
- [x] 案件类型列显示正确
- [x] 案由列显示正确
- [x] 法院列显示正确
- [x] **立案日期列显示正确** ✅
- [x] 状态列显示正确（带颜色标签）
- [x] 操作列功能正常
- [x] 长文本悬停提示正常
- [x] 空数据提示正常
- [ ] 前端浏览器测试

## 相关文件

- ✅ `frontend/src/components/case/PartyManagement.vue` - 组件代码
- ✅ `backend/src/models/LitigationParty.js` - 后端查询
- ✅ `backend/src/controllers/partyController.js` - 控制器
- ✅ `PARTY-HISTORY-FIX.md` - 修复说明

## 状态

🟢 **功能完成**

- ✅ 案号显示
- ✅ 案件类型显示
- ✅ 案由显示
- ✅ 法院显示
- ✅ **立案日期显示** ✅
- ✅ 状态标签显示
- ✅ 查看功能
- ⏳ 等待前端测试

---

**完成时间**: 2024-11-21  
**功能**: 诉讼主体历史案件完整展示  
**包含**: 案号、案件类型、案由、法院、立案日期、状态
