# 测试文书上传功能

## 测试步骤

### 1. 确认后端服务运行

确保后端服务正在运行：
```bash
cd legal-case-management/backend
npm start
```

### 2. 确认前端服务运行

确保前端服务正在运行：
```bash
cd legal-case-management/frontend
npm run dev
```

### 3. 打开浏览器

1. 打开浏览器，访问 http://localhost:5173
2. 登录系统（用户名：admin，密码：admin123）
3. 进入案件列表页面
4. 点击任意案件进入案件详情页

### 4. 测试上传文书

1. 在案件详情页找到"文书材料"模块
2. 点击"上传文书"按钮
3. 在弹出的对话框中：
   - 选择文书类型（例如：起诉状）
   - 点击"选择文件"按钮，选择一个文件（支持 PDF、Word、TXT）
   - 可选：填写备注信息
4. 点击"上传"按钮
5. 等待上传完成，应该看到"上传成功"的提示

### 5. 检查文书列表

上传成功后，文书列表应该自动刷新并显示新上传的文书。

### 6. 查看浏览器控制台

打开浏览器的开发者工具（F12），查看控制台输出：

应该看到类似以下的调试日志：
```
开始刷新文书列表...
fetchDocuments: 开始获取案件 1 的文书列表
fetchDocuments: API响应 {data: {documents: [...]}}
fetchDocuments: 原始文书数据 [...]
fetchDocuments: 转换后的文书列表 [...]
fetchDocuments: documentList.value已更新 [...]
文书列表刷新完成，当前列表: [...]
```

## 已知问题

### 问题1：上传成功但列表不显示

**症状**：点击上传后提示"上传成功"，但文书列表中没有显示新上传的文书。

**可能原因**：
1. 前端数据转换问题
2. API响应格式不匹配
3. 列表刷新逻辑问题

**调试方法**：
1. 打开浏览器控制台，查看调试日志
2. 检查 API 响应数据格式
3. 检查数据转换逻辑

**解决方案**：
- 已添加详细的调试日志
- 检查 `response.data.documents` 是否正确
- 确认字段映射是否正确（`document_name` -> `fileName`）

### 问题2：文件名显示为乱码

**症状**：上传的文件名包含中文时显示为乱码。

**原因**：文件编码问题。

**解决方案**：
- 后端使用 UTF-8 编码保存文件名
- 前端正确解析 UTF-8 编码

## 数据库检查

可以直接查询数据库确认文书是否已保存：

```bash
node legal-case-management/backend/check-documents.js
```

应该看到类似以下输出：
```
查询数据库中的文书数据...

共找到 X 条文书记录:

1. ID: 4
   案件ID: 1
   类型: 起诉状
   名称: test-complaint.txt
   文件名: 1763563244047-282710849.txt
   创建时间: 2025-11-19 14:40:44
```

## API 测试

可以使用测试脚本验证 API：

```bash
# 测试上传功能
node legal-case-management/backend/test-document-upload.js

# 测试获取文书列表
node legal-case-management/backend/test-get-documents.js
```

## 当前状态

- ✅ 后端上传接口正常工作
- ✅ 数据正确保存到数据库
- ✅ API 返回正确的数据格式
- ⚠️ 前端列表显示需要进一步调试

## 下一步

1. 在浏览器中测试上传功能
2. 查看控制台调试日志
3. 根据日志输出定位问题
4. 修复数据显示问题
5. 移除调试日志
