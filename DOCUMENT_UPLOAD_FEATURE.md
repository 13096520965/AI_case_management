# 文书上传功能说明

## 功能概述

在案件详情页的"文书材料"模块中，新增了"上传文书"功能，用户可以直接上传文书文件（PDF、Word、TXT格式）。

## 功能位置

**案件详情页 → 文书材料模块**

在"智能生成文书"按钮旁边，新增了"上传文书"按钮。

## 使用方法

### 1. 上传文书

1. 在案件详情页找到"文书材料"模块
2. 点击"上传文书"按钮
3. 在弹出的对话框中：
   - 选择文书类型（起诉状、答辩状、上诉状等）
   - 点击"选择文件"按钮，选择要上传的文件
   - 可选：填写备注信息
4. 点击"上传"按钮完成上传

### 2. 支持的文件格式

- PDF (.pdf)
- Word (.doc, .docx)
- 文本文件 (.txt)

### 3. 文件大小限制

- 最大文件大小：50MB

## 技术实现

### 前端

1. **CaseDetail.vue**
   - 添加了"上传文书"按钮
   - 添加了上传文书对话框
   - 实现了文件选择和上传逻辑

2. **document.ts API**
   - 新增 `uploadDocument` 方法
   - 使用 FormData 上传文件

### 后端

1. **document.js 路由**
   - 新增 `POST /api/documents/upload` 路由

2. **documentController.js**
   - 实现 `uploadDocument` 方法
   - 使用 multer 处理文件上传
   - 文件存储在 `backend/uploads/documents/` 目录

3. **数据库**
   - 为 `smart_documents` 表添加了以下字段：
     - `file_name`: 存储文件名
     - `file_path`: 存储文件路径
     - `file_size`: 存储文件大小
   - 将 `content` 字段改为可空

## 测试

运行测试脚本验证功能：

```bash
node backend/test-document-upload.js
```

测试结果：
- ✓ 文书上传成功
- ✓ 文件正确保存到数据库
- ✓ 文书列表正确显示上传的文件

## 与智能生成文书的区别

| 功能 | 智能生成文书 | 上传文书 |
|------|-------------|---------|
| 来源 | AI自动生成 | 用户上传文件 |
| 内容 | 纯文本内容 | 文件（PDF/Word/TXT） |
| 存储 | 仅存储文本内容 | 存储文件和元数据 |
| 用途 | 快速生成标准文书 | 保存已有文书文件 |

## 后续优化建议

1. 添加文件预览功能
2. 支持更多文件格式（如图片、Excel等）
3. 添加文件下载功能
4. 实现文件的OCR识别，提取文本内容
5. 添加文件版本管理

## 更新日期

2025-11-19
