# 快速测试指南

## 测试前准备

1. **确认服务运行**
   ```bash
   # 后端服务应该在运行
   # 前端服务应该在运行
   ```

2. **清理旧数据（可选）**
   ```bash
   node legal-case-management/backend/clean-garbled-documents.js
   ```

## 测试步骤

### 1. 测试中文文件名上传

1. 打开浏览器，访问 http://localhost:5173
2. 登录系统（admin / admin123）
3. 进入任意案件详情页
4. 找到"文书材料"模块
5. 点击"上传文书"按钮
6. 选择文书类型：起诉状
7. 选择一个中文文件名的文件（如"测试文书.txt"）
8. 点击"上传"

**预期结果**：
- ✅ 提示"上传成功"
- ✅ 文书列表中显示正确的中文文件名
- ✅ 没有乱码

### 2. 测试预览功能

1. 在文书列表中找到刚才上传的文书
2. 点击"预览"按钮

**预期结果**：
- ✅ 弹出预览对话框
- ✅ 显示文件内容
- ✅ 对话框不会闪现后消失

**注意**：
- 文本文件（.txt）可以直接预览
- PDF、Word 文件会提示"该文件类型不支持在线预览，请下载后查看"

### 3. 测试下载功能

1. 在文书列表中找到文书
2. 点击"下载"按钮

**预期结果**：
- ✅ 浏览器开始下载文件
- ✅ 下载的文件名正确（中文显示正常）
- ✅ 文件内容完整

### 4. 测试数据互通

1. 在案件详情页上传一个文书
2. 点击右上角的"查看详情"按钮
3. 进入文书管理页面

**预期结果**：
- ✅ 能看到刚才上传的文书
- ✅ 文件名显示正确
- ✅ 数据完全一致

### 5. 测试删除功能

1. 在文书列表中找到要删除的文书
2. 点击"删除"按钮
3. 确认删除

**预期结果**：
- ✅ 提示"删除成功"
- ✅ 文书从列表中消失
- ✅ 物理文件也被删除

## 常见问题

### Q1: 上传后文件名还是乱码？

**A**: 
1. 确认后端服务已重启
2. 运行清理脚本：`node backend/clean-garbled-documents.js`
3. 重新上传文件

### Q2: 预览窗口一闪而过？

**A**: 
1. 打开浏览器控制台（F12）
2. 查看错误信息
3. 如果是 PDF/Word 文件，这是正常的（不支持预览）
4. 如果是文本文件，检查文件内容是否为空

### Q3: 下载的文件名不对？

**A**: 
1. 检查浏览器的下载设置
2. 确认后端代码已更新
3. 重启后端服务

### Q4: 文书管理页面看不到数据？

**A**: 
1. 刷新浏览器（Ctrl+F5）
2. 检查浏览器控制台的错误
3. 确认前端代码已更新

## 自动化测试

如果不想手动测试，可以运行自动化测试脚本：

```bash
# 测试中文文件名
node legal-case-management/backend/test-chinese-filename.js

# 测试预览功能
node legal-case-management/backend/test-preview.js

# 测试完整流程
node legal-case-management/backend/test-document-upload.js
```

## 测试检查清单

- [ ] 中文文件名上传正常
- [ ] 文件名显示无乱码
- [ ] 文本文件可以预览
- [ ] 下载功能正常
- [ ] 下载的文件名正确
- [ ] 删除功能正常
- [ ] 案件详情页和文书管理页面数据一致
- [ ] 智能生成的文书可以预览

## 如果所有测试都通过

恭喜！文书上传功能已经完全正常工作了。

## 如果测试失败

1. 查看浏览器控制台的错误信息
2. 查看后端服务的日志
3. 确认代码已更新并重启服务
4. 参考 FINAL_DOCUMENT_UPLOAD_GUIDE.md 中的故障排查部分
