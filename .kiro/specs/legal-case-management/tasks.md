# 智能案管系统实施任务清单

## 项目初始化

- [x] 1. 创建项目基础结构
  - 创建根目录 `legal-case-management/`
  - 创建前端目录 `frontend/` 和后端目录 `backend/`
  - 初始化 Git 仓库
  - 创建项目 README.md 文档
  - _需求: 需求 1-29 (所有需求的基础)_

- [x] 2. 初始化后端项目
  - 在 `backend/` 目录初始化 npm 项目
  - 安装 Express.js、SQLite3、Multer、jsonwebtoken、bcryptjs、cors、dotenv 依赖
  - 创建基础目录结构 (src/routes, src/controllers, src/services, src/models, src/middleware, src/utils, src/config)
  - 创建 .env 配置文件
  - 创建 app.js 入口文件
  - _需求: 需求 1-29 (所有需求的基础)_

- [x] 3. 初始化前端项目
  - 使用 Vite 创建 Vue 3 + TypeScript 项目
  - 安装 Element Plus、Vue Router、Pinia、Axios、ECharts 依赖
  - 配置 Vite 和 TypeScript
  - 创建基础目录结构 (src/views, src/components, src/api, src/stores, src/router, src/utils, src/types)
  - 配置 Element Plus 自动导入
  - _需求: 需求 1-29 (所有需求的基础)_

## 后端核心功能开发

- [x] 4. 数据库设计与初始化
  - [x] 4.1 创建数据库初始化脚本
    - 编写 SQL 脚本创建所有数据表 (cases, litigation_parties, process_nodes, evidence, documents, cost_records, notification_tasks, users)
    - 创建数据库连接工具类
    - 实现数据库初始化函数
    - _需求: 需求 1, 2, 4, 7, 10, 14, 26_
  
  - [x] 4.2 创建数据模型层
    - 实现 Case 模型的 CRUD 操作
    - 实现 LitigationParty 模型的 CRUD 操作
    - 实现 ProcessNode 模型的 CRUD 操作
    - 实现 Evidence 模型的 CRUD 操作
    - 实现 Document 模型的 CRUD 操作
    - 实现 CostRecord 模型的 CRUD 操作
    - 实现 NotificationTask 模型的 CRUD 操作
    - 实现 User 模型的 CRUD 操作
    - _需求: 需求 1, 2, 4, 7, 10, 14, 18, 29_

- [x] 5. 用户认证系统
  - [x] 5.1 实现用户注册功能
    - 创建用户注册接口
    - 实现密码加密 (bcryptjs)
    - 验证用户名唯一性
    - _需求: 需求 29_
  
  - [x] 5.2 实现用户登录功能
    - 创建登录接口
    - 验证用户名和密码
    - 生成 JWT token
    - _需求: 需求 29_
  
  - [x] 5.3 实现认证中间件
    - 创建 JWT 验证中间件
    - 实现权限检查中间件
    - 处理 token 过期和刷新
    - _需求: 需求 29_

- [x] 6. 案件管理 API
  - [x] 6.1 实现案件基础 CRUD 接口
    - POST /api/cases - 创建案件
    - GET /api/cases - 获取案件列表（支持分页、筛选、搜索）
    - GET /api/cases/:id - 获取案件详情
    - PUT /api/cases/:id - 更新案件信息
    - DELETE /api/cases/:id - 删除案件
    - _需求: 需求 2_
  
  - [x] 6.2 实现诉讼主体管理接口
    - POST /api/cases/:caseId/parties - 添加诉讼主体
    - GET /api/cases/:caseId/parties - 获取诉讼主体列表
    - PUT /api/parties/:id - 更新诉讼主体
    - DELETE /api/parties/:id - 删除诉讼主体
    - 实现主体历史案件关联查询
    - _需求: 需求 1_
  
  - [x] 6.3 实现案件编号生成逻辑
    - 自动生成唯一的内部案件编号
    - 验证案号唯一性
    - _需求: 需求 2_

- [x] 7. 流程节点管理 API
  - [x] 7.1 实现流程节点 CRUD 接口
    - POST /api/cases/:caseId/nodes - 创建流程节点
    - GET /api/cases/:caseId/nodes - 获取流程节点列表
    - PUT /api/nodes/:id - 更新节点状态
    - DELETE /api/nodes/:id - 删除节点
    - _需求: 需求 7_
  
  - [x] 7.2 实现流程模板管理
    - 创建默认流程模板（民事、刑事、行政、劳动仲裁）
    - 实现流程模板的增删改查
    - 实现根据案件类型自动应用流程模板
    - _需求: 需求 9_
  
  - [x] 7.3 实现节点状态计算逻辑
    - 计算节点是否超期
    - 自动更新节点状态（待处理/进行中/已完成/超期）
    - _需求: 需求 8, 19_

- [x] 8. 证据管理 API
  - [x] 8.1 实现文件上传功能
    - 配置 Multer 文件上传中间件
    - POST /api/evidence/upload - 上传证据文件
    - 支持 PDF、图片、音频、视频格式
    - 生成唯一文件名并存储
    - _需求: 需求 4_
  
  - [x] 8.2 实现证据管理接口
    - GET /api/cases/:caseId/evidence - 获取证据列表
    - GET /api/evidence/:id - 获取证据详情
    - GET /api/evidence/:id/download - 下载证据文件
    - DELETE /api/evidence/:id - 删除证据
    - PUT /api/evidence/:id - 更新证据信息（分类、标签）
    - _需求: 需求 4, 5_
  
  - [x] 8.3 实现证据版本控制
    - 记录证据文件的版本历史
    - 支持查看历史版本
    - _需求: 需求 6_
  
  - [x] 8.4 实现证据操作日志
    - 记录所有证据操作（查看、下载、修改、删除）
    - 提供操作日志查询接口
    - _需求: 需求 6, 29_

- [x] 9. 文书管理 API
  - [x] 9.1 实现文书上传和管理接口
    - POST /api/documents/upload - 上传文书
    - GET /api/cases/:caseId/documents - 获取文书列表
    - GET /api/documents/:id - 获取文书详情
    - GET /api/documents/:id/download - 下载文书
    - DELETE /api/documents/:id - 删除文书
    - _需求: 需求 11_
  
  - [x] 9.2 实现文书分类归档
    - 自动识别文书类型（起诉状、答辩状、判决书等）
    - 按类型归档文书
    - _需求: 需求 11_
  
  - [x] 9.3 预留 OCR 识别接口
    - 创建 OCR 服务接口定义
    - 实现模拟 OCR 识别功能（返回示例数据）
    - 预留对接第三方 OCR 服务的接口
    - _需求: 需求 3, 10_
  
  - [x] 9.4 实现文书模板管理
    - 创建文书模板数据结构
    - 实现模板的增删改查
    - 实现基于模板生成文书的接口
    - _需求: 需求 12_

- [x] 10. 成本管理 API
  - [x] 10.1 实现成本记录 CRUD 接口
    - POST /api/costs - 创建成本记录
    - GET /api/cases/:caseId/costs - 获取成本列表
    - PUT /api/costs/:id - 更新成本记录
    - DELETE /api/costs/:id - 删除成本记录
    - _需求: 需求 14_
  
  - [x] 10.2 实现费用计算器
    - 实现诉讼费计算逻辑（按标的额分段计算）
    - 实现律师费计算逻辑（标的额比例、固定收费、按时计费）
    - 实现保全费计算逻辑
    - 实现违约金计算逻辑（支持复利）
    - POST /api/costs/calculate - 费用计算接口
    - _需求: 需求 15, 16_
  
  - [x] 10.3 实现成本统计分析
    - 计算案件总成本
    - 计算各类成本占比
    - 生成成本趋势数据
    - GET /api/costs/analytics - 成本分析接口
    - _需求: 需求 17_

- [x] 11. 提醒预警系统
  - [x] 11.1 实现提醒任务管理
    - 创建提醒任务数据模型
    - 实现提醒任务的增删改查
    - GET /api/notifications - 获取提醒列表
    - PUT /api/notifications/:id/read - 标记已读
    - _需求: 需求 18_
  
  - [x] 11.2 实现提醒规则配置
    - 创建提醒规则数据结构
    - 实现提醒规则的增删改查
    - 支持配置提醒阈值、频次、接收人
    - _需求: 需求 20_
  
  - [x] 11.3 实现提醒调度任务
    - 使用 node-cron 创建定时任务
    - 每天检查待发送的提醒
    - 检查节点是否超期并触发预警
    - 检查费用支付日期并触发提醒
    - _需求: 需求 18, 19, 21_
  
  - [x] 11.4 实现提醒发送功能
    - 实现系统消息推送
    - 预留短信和邮件接口
    - 记录提醒发送历史
    - _需求: 需求 18_

- [x] 12. 数据分析 API
  - [x] 12.1 实现驾驶舱数据统计
    - 统计案件总量、标的额总计
    - 计算平均胜诉率
    - 统计案件类型分布
    - 生成案件数量趋势数据
    - GET /api/analytics/dashboard - 驾驶舱数据接口
    - _需求: 需求 24_
  
  - [x] 12.2 实现律师评价统计
    - 统计律师胜诉率
    - 计算律师平均办案周期
    - 生成律师综合评分
    - GET /api/analytics/lawyers/:id/evaluation - 律师评价接口
    - _需求: 需求 23_
  
  - [x] 12.3 预留类案检索接口
    - 创建类案检索接口定义
    - 实现模拟类案匹配功能
    - 预留对接案例库的接口
    - _需求: 需求 13_

- [ ] 13. 协同管理 API
  - [x] 13.1 实现协作成员管理
    - POST /api/collaboration/cases/:caseId/members - 添加协作成员
    - GET /api/collaboration/cases/:caseId/members - 获取成员列表
    - DELETE /api/collaboration/members/:id - 移除成员
    - 实现成员权限设置
    - _需求: 需求 22_
  
  - [x] 13.2 实现协作任务管理
    - POST /api/collaboration/tasks - 创建协作任务
    - GET /api/collaboration/cases/:caseId/tasks - 获取任务列表
    - PUT /api/collaboration/tasks/:id - 更新任务状态
    - DELETE /api/collaboration/tasks/:id - 删除任务
    - _需求: 需求 22_

- [x] 14. 归档管理 API
  - [ ] 14.1 实现结案报告管理
    - POST /api/archive/closure-report - 创建结案报告
    - GET /api/archive/closure-report/:caseId - 获取结案报告
    - PUT /api/archive/closure-report/:id - 更新结案报告
    - _需求: 需求 26_
  
  - [x] 14.2 实现案件归档功能
    - POST /api/archive/package - 创建归档包
    - 自动打包案件所有相关数据
    - 生成唯一归档编号
    - GET /api/archive/search - 检索归档案件
    - _需求: 需求 27_
  
  - [x] 14.3 实现案例知识库
    - POST /api/archive/knowledge - 创建案例知识
    - GET /api/archive/knowledge - 检索案例知识库
    - 支持按案由、争议焦点分类
    - 支持关键词检索
    - _需求: 需求 28_

## 前端核心功能开发

- [ ] 15. 前端基础架构
  - [x] 15.1 配置路由系统
    - 创建 Vue Router 配置
    - 定义所有页面路由
    - 实现路由守卫（认证检查）
    - _需求: 需求 29_
  
  - [x] 15.2 配置状态管理
    - 创建 Pinia stores
    - 实现 user store（用户信息、认证状态）
    - 实现 case store（案件数据）
    - 实现 notification store（提醒数据）
    - _需求: 需求 1-29_
  
  - [x] 15.3 封装 API 请求
    - 配置 Axios 实例
    - 实现请求拦截器（添加 token）
    - 实现响应拦截器（错误处理）
    - 创建所有 API 接口函数
    - _需求: 需求 1-29_
  
  - [x] 15.4 创建公共组件
    - 创建页面布局组件（Header、Sidebar、Footer）
    - 创建表格组件（支持分页、筛选）
    - 创建表单组件
    - 创建文件上传组件
    - _需求: 需求 1-29_

- [x] 16. 用户认证页面
  - [x] 16.1 实现登录页面
    - 创建登录表单
    - 实现登录逻辑
    - 保存 token 到 localStorage
    - 登录成功后跳转到首页
    - _需求: 需求 29_
  
  - [x] 16.2 实现注册页面
    - 创建注册表单
    - 实现表单验证
    - 调用注册接口
    - _需求: 需求 29_

- [x] 17. 首页/驾驶舱页面
  - [x] 17.1 实现数据统计卡片
    - 显示案件总量
    - 显示标的额总计
    - 显示平均胜诉率
    - 显示待办事项数量
    - _需求: 需求 24_
  
  - [x] 17.2 实现数据可视化图表
    - 使用 ECharts 创建案件类型分布饼图
    - 创建案件数量趋势折线图
    - 创建成本分析柱状图
    - _需求: 需求 24_
  
  - [x] 17.3 实现待办事项列表
    - 显示即将到期的节点
    - 显示超期预警
    - 显示待支付费用
    - _需求: 需求 18, 19, 21_

- [x] 18. 案件管理页面
  - [x] 18.1 实现案件列表页面
    - 创建案件列表表格
    - 实现分页功能
    - 实现搜索功能（案号、案由）
    - 实现筛选功能（案件类型、状态）
    - 实现排序功能
    - _需求: 需求 2_
  
  - [x] 18.2 实现案件创建/编辑表单
    - 创建案件基础信息表单
    - 实现表单验证
    - 调用创建/更新接口
    - _需求: 需求 2_
  
  - [x] 18.3 实现案件详情页面
    - 显示案件基础信息
    - 显示诉讼主体列表
    - 显示流程节点时间轴
    - 显示证据列表
    - 显示文书列表
    - 显示成本记录
    - _需求: 需求 2_
  
  - [x] 18.4 实现诉讼主体管理
    - 创建添加主体表单（区分企业/个人）
    - 显示主体列表
    - 实现主体编辑和删除
    - 显示主体历史案件
    - _需求: 需求 1_

- [x] 19. 流程管理页面
  - [x] 19.1 实现流程时间轴展示
    - 使用 Element Plus Timeline 组件
    - 按节点顺序展示流程
    - 使用颜色区分节点状态（红/黄/绿）
    - _需求: 需求 8_
  
  - [x] 19.2 实现节点详情编辑
    - 创建节点编辑表单
    - 录入经办人、办理时间、关键进展
    - 上传相关文书
    - 更新节点状态
    - _需求: 需求 7_
  
  - [x] 19.3 实现流程模板配置
    - 创建流程模板管理页面
    - 实现模板的增删改查
    - 配置节点和时限
    - _需求: 需求 9_

- [x] 20. 证据管理页面
  - [x] 20.1 实现证据列表展示
    - 创建证据列表（支持列表/网格视图）
    - 显示文件缩略图
    - 显示文件基本信息
    - 实现按分类和标签筛选
    - _需求: 需求 4, 5_
  
  - [x] 20.2 实现证据上传功能
    - 创建文件上传组件
    - 支持拖拽上传
    - 支持多文件上传
    - 显示上传进度
    - 设置证据分类和标签
    - _需求: 需求 4, 5_
  
  - [x] 20.3 实现证据预览功能
    - 实现图片预览
    - 实现 PDF 预览
    - 实现音频播放
    - 实现视频播放
    - _需求: 需求 6_
  
  - [x] 20.4 实现证据下载和删除
    - 实现文件下载
    - 实现批量下载
    - 实现删除确认
    - _需求: 需求 4_

- [x] 21. 文书管理页面
  - [x] 21.1 实现文书列表展示
    - 创建文书列表
    - 按类型分类展示
    - 支持关键词搜索
    - _需求: 需求 11_
  
  - [x] 21.2 实现文书上传功能
    - 创建文书上传表单
    - 选择文书类型
    - 上传文书文件
    - _需求: 需求 11_
  
  - [x] 21.3 实现文书生成功能
    - 创建文书模板选择页面
    - 显示模板预览
    - 自动填充案件信息
    - 支持在线编辑
    - 导出为 Word/PDF
    - _需求: 需求 12_
  
  - [x] 21.4 实现 OCR 识别功能（模拟）
    - 创建文书识别页面
    - 上传文书后显示识别结果
    - 支持手动修正
    - 一键填充到案件表单
    - _需求: 需求 3, 10_

- [x] 22. 成本管理页面
  - [x] 22.1 实现成本记录列表
    - 创建成本记录表格
    - 显示各类费用
    - 显示支付状态
    - 实现筛选和排序
    - _需求: 需求 14_
  
  - [x] 22.2 实现成本记录表单
    - 创建添加/编辑成本表单
    - 选择费用类型
    - 录入金额和支付信息
    - 上传凭证文件
    - _需求: 需求 14_
  
  - [x] 22.3 实现费用计算器
    - 创建计算器页面
    - 实现诉讼费计算器
    - 实现律师费计算器
    - 实现保全费/违约金计算器
    - 显示计算结果和明细
    - _需求: 需求 15, 16_
  
  - [x] 22.4 实现成本分析图表
    - 创建成本分析页面
    - 显示案件总成本
    - 显示成本占比饼图
    - 显示成本趋势图
    - _需求: 需求 17_

- [x] 23. 提醒中心页面
  - [x] 23.1 实现提醒列表
    - 创建提醒列表
    - 区分不同类型的提醒
    - 显示提醒时间和内容
    - 实现标记已读
    - _需求: 需求 18_
  
  - [x] 23.2 实现提醒规则配置
    - 创建提醒规则管理页面
    - 配置提醒阈值
    - 配置提醒频次
    - 配置接收人
    - _需求: 需求 20_
  
  - [x] 23.3 实现超期预警展示
    - 创建预警列表
    - 高亮显示超期节点
    - 显示超期时长
    - 提供处理建议
    - _需求: 需求 19_

- [ ] 24. 数据分析页面
  - [x] 24.1 实现可视化驾驶舱
    - 创建驾驶舱布局
    - 显示关键指标卡片
    - 显示多维度图表
    - 支持时间范围筛选
    - _需求: 需求 24_
  
  - [x] 24.2 实现律师评价页面
    - 创建律师列表
    - 显示律师评分
    - 显示评价维度明细
    - 生成评价报告
    - _需求: 需求 23_
  
  - [x] 24.3 实现类案检索页面（模拟）
    - 创建检索表单
    - 输入案件要素
    - 显示相似案例列表
    - 显示胜诉率分析
    - _需求: 需求 13_

- [x] 25. 协同管理页面
  - [x] 25.1 实现协作成员管理
    - 创建成员列表
    - 实现添加成员
    - 设置成员权限
    - 移除成员
    - _需求: 需求 22_
  
  - [x] 25.2 实现协作任务管理
    - 创建任务列表
    - 实现任务分配
    - 显示任务状态
    - 提交任务成果
    - _需求: 需求 22_

- [x] 26. 归档管理页面
  - [x] 26.1 实现结案报告编辑
    - 创建结案报告表单
    - 自动填充案件信息
    - 编辑经验总结和风险提示
    - 提交审批
    - _需求: 需求 26_
  
  - [x] 26.2 实现归档案件检索
    - 创建归档检索页面
    - 支持多维度检索
    - 显示归档案件列表
    - 查看归档详情
    - _需求: 需求 27_
  
  - [x] 26.3 实现案例知识库
    - 创建知识库页面
    - 按案由分类展示
    - 支持关键词检索
    - 显示案例详情
    - 支持收藏和评论
    - _需求: 需求 28_

## 系统集成与优化

- [ ] 27. 权限管理系统
  - 实现基于角色的权限控制
  - 配置不同角色的权限
  - 实现页面级权限控制
  - 实现功能级权限控制
  - _需求: 需求 29_

- [ ] 28. 错误处理和日志
  - 实现全局错误处理
  - 实现操作日志记录
  - 创建日志查询接口
  - 前端实现友好的错误提示
  - _需求: 需求 29_

- [ ] 29. 性能优化
  - 实现数据库查询优化
  - 添加必要的索引
  - 实现前端路由懒加载
  - 实现图片懒加载
  - 优化大文件上传
  - _需求: 需求 4_

- [ ] 30. 项目文档和部署
  - 编写 API 文档
  - 编写用户使用手册
  - 创建部署脚本
  - 编写 Docker 配置（可选）
  - 创建启动说明文档
  - _需求: 需求 1-29_
